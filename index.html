<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="screen-orientation" content="landscape">
    <meta name="x5-orientation" content="landscape">
    <meta name="x5-page-mode" content="landscape">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>æ–°å¹´çƒŸèŠ±ç¥ç¦</title>
    <style>
        
        /* å…¨å±€é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
            font-family: "Microsoft Yahei", "å¾®è½¯é›…é»‘", sans-serif;
        }

        /* å¼ºåˆ¶æ¨ªå±æç¤ºå±‚ */
        .orientation-lock {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #0a0a0a;
            color: #ffd700;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 99999 !important;
            font-family: 'æ¥·ä½“', 'KaiTi', serif;
            text-align: center;
            padding: 20px;
        }
        
        .orientation-lock .icon {
            font-size: 80px;
            margin-bottom: 30px;
            animation: rotatePhone 2s infinite ease-in-out;
        }
        
        .orientation-lock .text {
            font-size: 30px;
            margin-bottom: 10px;
        }
        
        .orientation-lock .subtext {
            font-size: 18px;
            opacity: 0.8;
        }
        
        .wechat-tip {
            margin-top: 20px;
            font-size: 16px;
            color: #ffd700;
            opacity: 0.9;
        }
        
        @keyframes rotatePhone {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); }
        }

        /* çƒŸèŠ±ç”»å¸ƒæ ·å¼ */
        #fireworksCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }

        /* éŸ³ä¹æ§åˆ¶æŒ‰é’® */
        .music-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.3);
            border: 2px solid #ffd700;
            color: #ffd700;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 999;
            animation: pulse 2s infinite ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        /* å°é¢æ–‡å­—æ ·å¼ */
        .cover-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffd700;
            font-size: 48px;
            text-align: center;
            text-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700;
            z-index: 10;
            animation: fadeIn 3s ease-in-out;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        /* æ‰‹åŠ¨å…³é—­æ¨ªå±æç¤ºçš„æŒ‰é’®æ ·å¼ */
        .orientation-lock button {
            margin-top: 30px;
            padding: 10px 20px;
            background: rgba(255,215,0,0.3);
            color: #ffd700;
            border: 2px solid #ffd700;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .orientation-lock button:hover {
            background: rgba(255,215,0,0.5);
        }
    </style>
</head>
<body>
    <!-- å¼ºåˆ¶æ¨ªå±æç¤ºå±‚ -->
    <div class="orientation-lock" id="orientationLock">
        <div class="icon">ğŸ“±</div>
        <div class="text">è¯·å°†æ‰‹æœºæ¨ªå±è§‚çœ‹</div>
        <div class="subtext">æ¨ªå±åå¯è·å¾—æœ€ä½³è§‚èµæ•ˆæœ</div>
        <div class="wechat-tip" id="wechatTip">
            è‹¥æ¨ªå±åä»æ˜¾ç¤ºæ­¤æç¤ºï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’ â†’ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
        </div>
        <button onclick="forceHideOrientationLock()">
            ä»è¦ç»§ç»­ï¼ˆç«–å±æ¨¡å¼ï¼‰
        </button>
    </div>

    <!-- çƒŸèŠ±ç”»å¸ƒ -->
    <canvas id="fireworksCanvas"></canvas>

    <!-- éŸ³ä¹æ’­æ”¾éŸ³é¢‘ -->
    <audio id="music" loop preload="auto">
        <!-- æ›¿æ¢ä¸ºä½ çš„éŸ³ä¹æ–‡ä»¶åœ°å€ï¼ˆå»ºè®®æ”¾åœ¨GitHubä»“åº“çš„files/music/ç›®å½•ä¸‹ï¼‰ -->
        <source src="files/music/happy_new_year.mp3" type="audio/mpeg">
    </audio>

    <!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
    <div class="music-btn" id="musicBtn" onclick="toggleMusic()">
        ğŸµ
    </div>

    <!-- ç¥ç¦æ–‡å­— -->
    <div class="cover-text" id="coverText">
        æ–°å¹´å¿«ä¹ï¼<br>æ„¿ä½ å²å²å¹´å¹´çš†æœ‰æ¬¢å–œ
    </div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        // ========== å…¨å±€å˜é‡ ==========
        let canvas, ctx, fireworks = [], particles = [], mouse = {x: 0, y: 0};
        let musicPlaying = false;
        const orientationLock = document.getElementById('orientationLock');
        const wechatTip = document.getElementById('wechatTip');
        const music = document.getElementById('music');
        const musicBtn = document.getElementById('musicBtn');
        const coverText = document.getElementById('coverText');

        // ========== ç¬¬ä¸€æ­¥ï¼šå¾®ä¿¡ç¯å¢ƒè¯†åˆ«ä¸æ¨ªå±æ£€æµ‹ ==========
        function isWeChat() {
            const ua = navigator.userAgent.toLowerCase();
            return ua.includes('micromessenger');
        }

        function checkOrientation() {
            // éå¾®ä¿¡ç¯å¢ƒï¼šæ ‡å‡†æ£€æµ‹
            if (!isWeChat()) {
                const isLandscape1 = window.orientation === 90 || window.orientation === -90;
                const isLandscape2 = window.innerWidth > window.innerHeight;
                const isLandscape3 = window.matchMedia("(orientation: landscape)").matches;
                const isLandscape = isLandscape1 || isLandscape2 || isLandscape3;
                
                if (isLandscape) {
                    orientationLock.style.display = 'none';
                    resizeCanvas();
                } else {
                    orientationLock.style.display = window.innerWidth < 768 ? 'flex' : 'none';
                }
            } else {
                // å¾®ä¿¡ç¯å¢ƒï¼šç‰¹æ®Šé€‚é…
                try {
                    if (window.WeixinJSBridge) {
                        WeixinJSBridge.invoke('setScreenOrientation', {
                            'orientation': 'landscape'
                        }, function(res) {});
                    }
                } catch (e) {}
                
                const isLandscape = window.innerWidth / window.innerHeight > 1.2;
                if (isLandscape) {
                    orientationLock.style.display = 'none';
                    resizeCanvas();
                } else {
                    orientationLock.style.display = 'flex';
                }
            }
        }

        // æ‰‹åŠ¨å…³é—­æ¨ªå±æç¤º
        function forceHideOrientationLock() {
            orientationLock.style.display = 'none';
            localStorage.setItem('forceHideOrientation', 'true');
            resizeCanvas();
        }

        // ========== ç¬¬äºŒæ­¥ï¼šéŸ³ä¹æ§åˆ¶é€»è¾‘ ==========
        function toggleMusic() {
            if (musicPlaying) {
                music.pause();
                musicBtn.innerHTML = "ğŸµ";
                musicPlaying = false;
            } else {
                // å¾®ä¿¡ç¯å¢ƒéœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾éŸ³é¢‘
                music.play().then(() => {
                    musicPlaying = true;
                    musicBtn.innerHTML = "ğŸ”Š";
                }).catch(err => {
                    alert("æ’­æ”¾å¤±è´¥ï¼Œè¯·ç‚¹å‡»å…è®¸éŸ³é¢‘æ’­æ”¾æƒé™");
                });
            }
        }

        // ========== ç¬¬ä¸‰æ­¥ï¼šçƒŸèŠ±æ•ˆæœæ ¸å¿ƒé€»è¾‘ ==========
        // åˆå§‹åŒ–ç”»å¸ƒ
        function initCanvas() {
            canvas = document.getElementById('fireworksCanvas');
            ctx = canvas.getContext('2d');
            resizeCanvas();
            
            // ç›‘å¬é¼ æ ‡/è§¦æ‘¸äº‹ä»¶
            canvas.addEventListener('mousemove', function(e) {
                mouse.x = e.clientX;
                mouse.y = e.clientY;
            });
            
            canvas.addEventListener('touchmove', function(e) {
                e.preventDefault();
                mouse.x = e.touches[0].clientX;
                mouse.y = e.touches[0].clientY;
            });
            
            canvas.addEventListener('click', createFirework);
            canvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                createFirework();
            });
            
            // è‡ªåŠ¨ç”ŸæˆçƒŸèŠ±
            setInterval(createFirework, 1500);
            
            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animate();
        }

        // è°ƒæ•´ç”»å¸ƒå¤§å°
        function resizeCanvas() {
            if (!canvas) return;
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        // åˆ›å»ºçƒŸèŠ±
        function createFirework() {
            // éšæœºä½ç½®ï¼ˆå¦‚æœæ²¡æœ‰é¼ æ ‡ä½ç½®åˆ™ç”¨å±å¹•ä¸­å¿ƒï¼‰
            const x = mouse.x || canvas.width / 2;
            const y = mouse.y || canvas.height / 2;
            
            // éšæœºé¢œè‰²
            const hue = Math.floor(Math.random() * 360);
            fireworks.push(new Firework(x, canvas.height, x, y, hue));
        }

        // çƒŸèŠ±ç±»
        class Firework {
            constructor(x, y, targetX, targetY, hue) {
                this.x = x;
                this.y = y;
                this.targetX = targetX;
                this.targetY = targetY;
                this.speed = 2;
                this.gravity = 0.05;
                this.velocity = {x: 0, y: 0};
                this.hue = hue;
                this.brightness = 100;
                this.targetRadius = 8;
                this.done = false;
            }

            update() {
                // è®¡ç®—ç›®æ ‡æ–¹å‘
                const dx = this.targetX - this.x;
                const dy = this.targetY - this.y;
                
                // åˆ°è¾¾ç›®æ ‡åçˆ†ç‚¸
                if (Math.sqrt(dx * dx + dy * dy) < this.targetRadius) {
                    // åˆ›å»ºç²’å­
                    for (let i = 0; i < 100; i++) {
                        particles.push(new Particle(this.targetX, this.targetY, this.hue));
                    }
                    this.done = true;
                    return;
                }
                
                // ç§»åŠ¨çƒŸèŠ±
                const angle = Math.atan2(dy, dx);
                this.velocity.x = Math.cos(angle) * this.speed;
                this.velocity.y = Math.sin(angle) * this.speed;
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                
                // é‡åŠ›å½±å“
                this.velocity.y += this.gravity;
                
                // äº®åº¦æ¸å˜
                this.brightness = Math.max(50, this.brightness - 0.5);
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
                ctx.fillStyle = `hsl(${this.hue}, 100%, ${this.brightness}%)`;
                ctx.fill();
            }
        }

        // ç²’å­ç±»
        class Particle {
            constructor(x, y, hue) {
                this.x = x;
                this.y = y;
                this.speed = Math.random() * 3 + 1;
                this.angle = Math.random() * Math.PI * 2;
                this.velocity = {
                    x: Math.cos(this.angle) * this.speed,
                    y: Math.sin(this.angle) * this.speed
                };
                this.gravity = 0.05;
                this.friction = 0.98;
                this.hue = hue;
                this.alpha = 1;
                this.decay = Math.random() * 0.01 + 0.005;
            }

            update() {
                // æ‘©æ“¦åŠ›
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;
                
                // é‡åŠ›
                this.velocity.y += this.gravity;
                
                // ç§»åŠ¨ç²’å­
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                
                // é€æ˜åº¦è¡°å‡
                this.alpha -= this.decay;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 1.5, 0, Math.PI * 2);
                ctx.fillStyle = `hsl(${this.hue}, 100%, 70%)`;
                ctx.fill();
                ctx.restore();
            }
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            // åŠé€æ˜èƒŒæ™¯ï¼ˆæ‹–å½±æ•ˆæœï¼‰
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // æ›´æ–°å’Œç»˜åˆ¶æ‰€æœ‰çƒŸèŠ±
            for (let i = fireworks.length - 1; i >= 0; i--) {
                const firework = fireworks[i];
                firework.update();
                firework.draw();
                
                // ç§»é™¤å·²å®Œæˆçš„çƒŸèŠ±
                if (firework.done) {
                    fireworks.splice(i, 1);
                }
            }
            
            // æ›´æ–°å’Œç»˜åˆ¶æ‰€æœ‰ç²’å­
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                particle.update();
                particle.draw();
                
                // ç§»é™¤é€æ˜çš„ç²’å­
                if (particle.alpha <= 0) {
                    particles.splice(i, 1);
                }
            }
            
            requestAnimationFrame(animate);
        }

        // ========== ç¬¬å››æ­¥ï¼šé¡µé¢åˆå§‹åŒ– ==========
        window.addEventListener('load', function() {
            // åˆå§‹åŒ–ç”»å¸ƒ
            initCanvas();
            
            // å¾®ä¿¡ç¯å¢ƒå¤„ç†
            if (!isWeChat()) {
                wechatTip.style.display = 'none';
            }
            
            // è¯»å–æ‰‹åŠ¨å…³é—­è®°å½•
            if (localStorage.getItem('forceHideOrientation') === 'true') {
                orientationLock.style.display = 'none';
            }
            
            // æ¨ªå±æ£€æµ‹
            checkOrientation();
            setInterval(checkOrientation, 300);
            
            // éšè—å°é¢æ–‡å­—ï¼ˆå¯é€‰ï¼š3ç§’åéšè—ï¼‰
            setTimeout(() => {
                coverText.style.opacity = 0;
                coverText.style.transition = 'opacity 2s ease';
            }, 5000);
        });

        // ç›‘å¬å±å¹•æ—‹è½¬å’Œå¤§å°å˜åŒ–
        window.addEventListener('orientationchange', checkOrientation);
        window.addEventListener('resize', function() {
            checkOrientation();
            resizeCanvas();
        });

        // å¾®ä¿¡JSæ¡¥å°±ç»ªäº‹ä»¶
        document.addEventListener('WeixinJSBridgeReady', checkOrientation);
    </script>
</body>
</html>
